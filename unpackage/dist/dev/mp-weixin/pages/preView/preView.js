"use strict";const e=require("../../common/vendor.js"),z=require("../../utils/system.js"),M=require("../../api/apis.js");require("../../utils/request.js");if(!Array){const f=e.resolveComponent("uni-icons"),p=e.resolveComponent("uni-dateformat"),o=e.resolveComponent("uni-rate"),s=e.resolveComponent("uni-popup");(f+p+o+s)()}const T=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",j=()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js",A=()=>"../../uni_modules/uni-rate/components/uni-rate/uni-rate.js",B=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(T+j+A+B)();const D={__name:"preView",setup(f){const p=e.ref(null),o=e.ref(0),s=e.ref([]),i=e.ref([]),a=e.ref(null),c=e.ref(!1),y=e.index.getStorageSync("strogClassList")||[];s.value=y.map(n=>({...n,picurl:n.smallPicurl.replace("_small.webp",".jpg")}));const v=e.ref(!0),w=()=>{v.value=!v.value},d=e.ref(null),x=()=>{d.value.open()},S=()=>{d.value.close()},m=e.ref(null),u=e.ref(0),k=()=>{a.value.userScore&&(c.value=!0,u.value=a.value.userScore),m.value.open()},_=()=>{m.value.close(),u.value=0,c.value=!1},C=async()=>{e.index.showLoading({title:"加载中..."});let{classid:n,_id:l}=a.value,t=await M.apiGetSetupScore({classid:n,wallId:l,userScore:u.value});e.index.hideLoading(),t.errCode===0&&(e.index.showToast({title:"评分成功",icon:"none"}),s.value[o.value].userScore=u.value,e.index.setStorageSync("strogClassList",s.value),_())};let{height:g}=e.index.getMenuButtonBoundingClientRect();const I=()=>{e.index.navigateBack()};e.onLoad(n=>{p.value=n.id,o.value=s.value.findIndex(l=>l._id==p.value),a.value=s.value[o.value],h()});const b=n=>{o.value=n.detail.current,a.value=s.value[o.value],h()},h=()=>{i.value.push(o.value<=0?s.value.length-1:o.value-1,o.value,o.value>=s.value.length-1?0:o.value+1),i.value=[...new Set(i.value)]},P=()=>{e.index.showLoading({title:"下载中...",mask:!0}),e.index.getImageInfo({src:a.value.picurl,success(n){e.index.saveImageToPhotosAlbum({filePath:n.path,success(l){e.index.showToast({title:"保存成功，请到相册查看",icon:"none"})},fail:l=>{if(l.errMsg=="uni.saveImageToPhotosAlbum:fail cancel"){e.index.showToast({title:"保存失败，请重新点击下载",icon:"none"});return}e.index.showModal({title:"授权提示",content:"需要授权保存相册",success:t=>{t.confirm&&e.index.openSetting({success:r=>{r.authSetting["scope.writePhotosAlbum"]?e.index.showToast({title:"获取授权成功",icon:"none"}):e.index.showToast({title:"获取授权失败！",icon:"none"})}})}})},complete:()=>{e.index.hideLoading()}})}})};return(n,l)=>({a:e.f(s.value,(t,r,L)=>e.e({a:i.value.includes(r)},i.value.includes(r)?{b:e.o(w,t._id),c:t.picurl}:{},{d:t._id})),b:o.value,c:e.o(b),d:e.p({type:"back",color:"#ccc",size:"20"}),e:e.o(I),f:e.unref(z.getStatusBarHeight)()+"px",g:e.unref(g)+"px",h:e.unref(g)+"px",i:e.t(o.value+1),j:e.t(s.value.length),k:e.p({date:Date.now(),format:"hh:mm"}),l:e.p({date:Date.now(),format:"MM月dd日"}),m:e.p({type:"info",size:"20"}),n:e.o(x),o:e.p({type:"star",size:"20"}),p:e.t(a.value.score),q:e.o(k),r:e.p({type:"download",size:"20"}),s:e.o(P),t:v.value,v:e.p({type:"closeempty",size:"18"}),w:e.o(S),x:e.t(a.value._id),y:e.t(a.value.nickname),z:e.o(t=>n.value=t),A:e.p({value:a.value.score,size:"16",readonly:!0,touchable:!0,modelValue:n.value}),B:e.t(a.value.score),C:e.t(a.value.description),D:e.f(a.value.tabs,(t,r,L)=>({a:e.t(t)})),E:e.sr(d,"18cea5aa-6",{k:"infoPopup"}),F:e.p({type:"bottom"}),G:e.t(c.value?"评分过了～":"壁纸评分"),H:e.p({type:"closeempty",size:"18"}),I:e.o(_),J:e.o(t=>u.value=t),K:e.p({allowHalf:!0,disabled:c.value,["disabled-color"]:"#FFCA3E",modelValue:u.value}),L:e.t(u.value),M:e.o(C),N:!u.value,O:!c.value,P:e.sr(m,"18cea5aa-9",{k:"scorePopup"}),Q:e.p({type:"center",["is-mask-click"]:!1})})}},q=e._export_sfc(D,[["__scopeId","data-v-18cea5aa"],["__file","/Users/izcw/Desktop/我的项目/DuoyuWallpaper/pages/preView/preView.vue"]]);wx.createPage(q);
