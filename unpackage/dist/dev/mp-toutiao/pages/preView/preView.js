"use strict";const e=require("../../common/vendor.js");require("../../utils/system.js");const f=require("../../api/apis.js");require("../../utils/request.js");if(!Array){const g=e.resolveComponent("uni-dateformat"),i=e.resolveComponent("uni-icons"),n=e.resolveComponent("uni-rate"),s=e.resolveComponent("uni-popup");(g+i+n+s)()}const D=()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js",T=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js",j=()=>"../../uni_modules/uni-rate/components/uni-rate/uni-rate.js",A=()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js";Math||(D+T+j+A)();const y={__name:"preView",setup(g){const i=e.ref(null),n=e.ref(0),s=e.ref([]),c=e.ref([]),o=e.ref(null),p=e.ref(!1),S=e.index.getStorageSync("strogClassList")||[];s.value=S.map(a=>({...a,picurl:a.smallPicurl.replace("_small.webp",".jpg")}));const v=e.ref(!0),x=()=>{v.value=!v.value},m=e.ref(null),k=()=>{m.value.open()},C=()=>{m.value.close()},_=e.ref(null),l=e.ref(0),I=()=>{o.value.userScore&&(p.value=!0,l.value=o.value.userScore),_.value.open()},h=()=>{_.value.close(),l.value=0,p.value=!1},b=async()=>{e.index.showLoading({title:"加载中..."});let{classid:a,_id:u}=o.value,t=await f.apiGetSetupScore({classid:a,wallId:u,userScore:l.value});e.index.hideLoading(),t.errCode===0&&(e.index.showToast({title:"评分成功",icon:"none"}),s.value[n.value].userScore=l.value,e.index.setStorageSync("strogClassList",s.value),h())};e.index.getMenuButtonBoundingClientRect(),e.onLoad(async a=>{if(i.value=a.id,a.type=="share"){let u=await f.apiDetaiWall({id:i.value});s.value=u.data.map(t=>({...t,picurl:t.smallPicurl.replace("_small.webp",".jpg")}))}n.value=s.value.findIndex(u=>u._id==i.value),o.value=s.value[n.value],w()});const P=a=>{n.value=a.detail.current,o.value=s.value[n.value],w()},w=()=>{c.value.push(n.value<=0?s.value.length-1:n.value-1,n.value,n.value>=s.value.length-1?0:n.value+1),c.value=[...new Set(c.value)]},L=async()=>{try{e.index.showLoading({title:"下载中...",mask:!0});let{classid:a,_id:u}=o.value,t=await f.apiWriteDownload({classid:a,wallId:u});if(t.errCode!=0)throw t;e.index.getImageInfo({src:o.value.picurl,success(r){e.index.saveImageToPhotosAlbum({filePath:r.path,success(d){e.index.showToast({title:"保存成功，请到相册查看",icon:"none"})},fail:d=>{if(d.errMsg=="uni.saveImageToPhotosAlbum:fail cancel"){e.index.showToast({title:"保存失败，请重新点击下载",icon:"none"});return}e.index.showModal({title:"授权提示",content:"需要授权保存相册",success:M=>{M.confirm&&e.index.openSetting({success:z=>{z.authSetting["scope.writePhotosAlbum"]?e.index.showToast({title:"获取授权成功",icon:"none"}):e.index.showToast({title:"获取授权失败！",icon:"none"})}})}})},complete:()=>{e.index.hideLoading()}})}})}catch(a){console.log(a),e.index.hideLoading()}};return e.onShareAppMessage(a=>({title:"多鱼壁纸",path:"/pages/preView/preView?id="+i.value+"&type=share"})),e.onShareTimeline(a=>({title:"多鱼壁纸",query:"id="+i.value+"&type=share"})),(a,u)=>e.e({a:o.value},o.value?{b:e.f(s.value,(t,r,d)=>e.e({a:c.value.includes(r)},c.value.includes(r)?{b:e.o(x),c:t.picurl}:{},{d:t._id})),c:n.value,d:e.o(P),e:e.t(n.value+1),f:e.t(s.value.length),g:e.p({date:Date.now(),format:"hh:mm"}),h:e.p({date:Date.now(),format:"MM月dd日"}),i:e.p({type:"info",size:"20"}),j:e.o(k),k:e.p({type:"star",size:"20"}),l:e.t(o.value.score),m:e.o(I),n:e.p({type:"download",size:"20"}),o:e.o(L),p:v.value,q:e.p({type:"closeempty",size:"18"}),r:e.o(C),s:e.t(o.value._id),t:e.t(o.value.nickname),v:e.o(t=>a.value=t),w:e.p({value:o.value.score,size:"16",readonly:!0,touchable:!0,modelValue:a.value}),x:e.t(o.value.score),y:e.t(o.value.description),z:e.f(o.value.tabs,(t,r,d)=>({a:e.t(t),b:r})),A:e.sr(m,"18cea5aa-5",{k:"infoPopup"}),B:e.p({type:"bottom"}),C:e.t(p.value?"评分过了～":"壁纸评分"),D:e.p({type:"closeempty",size:"18"}),E:e.o(h),F:e.o(t=>l.value=t),G:e.p({allowHalf:!0,disabled:p.value,["disabled-color"]:"#FFCA3E",modelValue:l.value}),H:e.t(l.value),I:e.o(b),J:!l.value,K:!p.value,L:e.sr(_,"18cea5aa-8",{k:"scorePopup"}),M:e.p({type:"center",["is-mask-click"]:!1})}:{})}},V=e._export_sfc(y,[["__scopeId","data-v-18cea5aa"],["__file","/Users/izcw/Desktop/我的项目/DuoyuWallpaper/pages/preView/preView.vue"]]);y.__runtimeHooks=6;tt.createPage(V);
